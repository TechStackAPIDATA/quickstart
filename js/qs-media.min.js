window.QS=window.QS||{},function(e){var t=window.QS.media={};_.extend(t,{attachment:function(e){return undefined===e&&(e=this.frame),e.state().get("selection").first().attributes},attachments:function(e){undefined===e&&(e=this.frame);var t=[];return("gallery-edit"===e.options.state?e.states.get("gallery-edit").get("library"):e.state().get("selection")).map((function(e){t.push(e.attributes)})),t},init:function(i,a,n){var r,l=wp.media(i);return a.events!==undefined&&_.each(a.events,(function(e,i){l.on(i,e,t)})),l.trigger("init",l),n?l:((r=a.$trigger?a.$trigger:e(a.trigger)).length>0&&r.on("click",(function(i){i.preventDefault(),t.frame=l,t.trigger=e(this),l.open()})),l)},preload:function(e,t){if(undefined===t&&(t=this.frame),e!==undefined){var i,a=t.state().get("selection");a.reset([]),"string"==typeof e?e=e.split(","):"object"!=typeof e&&(e=[e]),_.each(e,(function(e){(i=wp.media.attachment(e)).fetch(),a.add(i?[i]:[])}))}}}),_.extend(t,{insert:function(e,t){return e=_.extend({},{title:"Insert Media",choose:"Insert Selected Media",multiple:!1,trigger:".qs-button"},e),this.init({title:e.title,choose:e.choose,multiple:e.multiple,library:{type:e.media},button:{text:e.choose,close:!0}},e,t)},gallery:function(e,t){var i,a,n;return(e=_.extend({},{title:"Edit Gallery",trigger:".qs-button"},e)).gallery&&("string"!=typeof e.gallery&&(e.gallery=e.gallery.join(",")),i=(i=wp.shortcode.next("gallery",'[gallery ids="'+e.gallery+'"]')).shortcode,a=wp.media.gallery.attachments(i),(n=new wp.media.model.Selection(a.models,{props:a.props.toJSON(),multiple:!0})).gallery=a.gallery,n.more().done((function(){n.props.set({query:!1}),n.unmirror(),n.props.unset("orderby")}))),this.init({state:"gallery-edit",frame:"post",title:e.title,multiple:!0,editing:!0,selection:n},e,t)}}),QS.setupMedia=function(i,a){var n,r=e(this);i.preventDefault(),r.hasClass("qs-button")?(r=r.parents(".qs-field").eq(0),n=e(this)):n=r.find(".qs-button");var l=r.data("QS.setupMedia"),s=i.data||{};if(!l){var d=r.hasClass("multiple"),o=r.hasClass("gallery"),u=r.data("preload");null!=u&&""!==u||(u=!0);var p=r.data("show"),c=r.data("type")||"",m=(c+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,(function(e){return e.toUpperCase()}))||"File";m.indexOf("/")>=0&&(m=(m=m.replace(/.+?\//,"")).toUpperCase(),m+=" File");var f="Select "+m,g="Use Selected "+m;d&&(f+="s",g+="s");var h={trigger:".qs-button",preview:".qs-preview",input:".qs-value"};o?_.extend(h,{title:n.text(),events:{update:function(){var i=t.attachments(),a=[];l.$preview.empty(),_.each(i,(function(t){a.push(t.id);var i="";i="undefined"!=typeof t.sizes.thumbnail?t.sizes.thumbnail.url:t.sizes.full.url;var n=e('<img src="'+i+'">');l.$preview.append(n)})),l.$input.val(a.join(",")),l.$elm.removeClass("value-empty").addClass("value-filled"),l.$elm.trigger("qs:media-changed")}}}):_.extend(h,{container:".qs-container",template:".qs-template",title:f,choose:g,multiple:d,media:c,events:{open:function(){if(!d&&u){var e=l.$input.val();this.preload(e,this.frame)}},select:function(){var e=t.attachments();if(d){var i,a,n;_.each(e,(function(e){i=l.$template.clone(),a=i.find(l.preview),n=i.find(l.input),a.is("img")&&"image"===e.type?"undefined"!=typeof e.sizes.thumbnail?a.attr("src",e.sizes.thumbnail.url):a.attr("src",e.sizes.full.url):"title"===p?a.html(e.title):a.html(decodeURI(e.filename)),l.$container.find(".qs-clear").show(),"number"==typeof e.date&&(e.date=new Date(e.date)),i.data("name",e.filename.replace(/[^\w\-]+/g,"-").toLowerCase()),i.data("date",e.date.getTime()/1e3),n.val(e.id),l.$container.append(i).removeClass("value-empty").addClass("value-filled"),i.trigger("qs:media-added",[e])}))}else{var r,s=e[0];r=document.createElement("img"),l.$preview.empty(),"image"===s.type?"undefined"!=typeof s.sizes.medium?r.src=s.sizes.medium.url:r.src=s.sizes.full.url:r.src=s.icon,l.$preview.append(r),l.$input.val(s.id),l.$elm.removeClass("value-empty").addClass("value-filled"),l.$elm.trigger("qs:media-inserted",[s])}l.$elm.trigger("qs:media-changed")}}});var v=r.data()||{},y=_.pick(v,"title","choose","trigger","container","template","preview","input");l=_.extend({},h,s,y);var w=["trigger"];w=d?w.concat("container","template"):w.concat("preview","input"),function(e,t,i){_.each(i,(function(i){var a="$"+i;t[a]||(t[a]=e.find(t[i]))}))}(r,l,w),l.$elm=r,d&&l.$template.length>0&&(l.$template=e(l.$template.html())),o&&u&&l.gallery===undefined&&(l.gallery=l.$input.val());var b=o?"gallery":"insert";l.frame=t[b](l,!0),r.data("QS.setupMedia",l)}t.frame=l.frame,"initonly"!==a&&l.frame.open()},QS.addFile=function(){return QS.setupMedia.apply(this,arguments)},QS.editGallery=function(){var t=e(this);return t.data("type","image"),QS.setupMedia.apply(this,arguments)},QS.setImage=function(){var t=e(this);return t.data("type","image"),QS.setupMedia.apply(this,arguments)},jQuery.fn.QS=function(){var t,i,a=e(this),n=".qs-button";switch(arguments.length){case 3:n=arguments[0],t=arguments[1],i=arguments[2];break;case 2:"string"==typeof arguments[1]?(n=arguments[0],t=arguments[1]):(t=arguments[0],i=arguments[1]);break;case 1:t=arguments[0];break;default:return}var r=QS[t];return n?(a.on("click",n,i,r),a.find(n).trigger("click",["initonly"])):(a.on("click",i,r),a.trigger("click",["initonly"])),a},e(window).on("unload",(function(){window.QS=null})),e((function(){e("body").QS(".qs-media .qs-button","setupMedia"),e("body").QS(".qs-addfile .qs-button","addFile"),e("body").QS(".qs-editgallery .qs-button","editGallery")}))}(jQuery);