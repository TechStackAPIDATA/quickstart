window.QS=window.QS||{},function(e){var t=window.QS.helpers={};_.extend(t,{sortItems:function(t,a,n){"string"==typeof t&&(t=e(t));var s=t.children(a);"flip"===n?s.each((function(){e(this).prependTo(t)})):(s.sort((function(t,a){var s=e(t).data(n),i=e(a).data(n);return s===i?0:s>i?1:-1})),s.detach().appendTo(t)),t.sortable("refresh")}})}(jQuery),jQuery((function(e){e("body").on("click",".qs-delete",(function(){var t=e(this).parents(".qs-item");t.animate({height:"toggle",opacity:"toggle"},(function(){e(this).remove()})),t.trigger("qs:item-deleted")})),e("body").on("click",".qs-clear",(function(){var t=e(this).parents(".qs-field, .qs-repeater").eq(0);if(t.hasClass("qs-media")){if(t.hasClass("single")){var a=t.find(".qs-preview");a.html(a.attr("title")),t.find(".qs-value").val(""),t.removeClass("value-filled").addClass("value-empty")}else t.hasClass("gallery")?(t.find(".qs-preview").animate({height:"toggle",opacity:"toggle"},(function(){e(this).empty().show()})),t.find(".qs-value").val("")):t.hasClass("multiple")&&t.find(".qs-item").animate({height:"toggle",opacity:"toggle"},(function(){e(this).remove()}));t.trigger("qs:media-changed")}else t.find(".qs-item .qs-delete").click()})),e(".qs-sortable").each((function(){var t=e(this).data("axis");e(this).sortable({items:".qs-item",containment:"parent",axis:t||!1})})),e(".qs-field").on("click",".qs-sort button",(function(){var t=e(this).val(),a=e(this).parents(".qs-field");t&&QS.helpers.sortItems(a.find(".qs-container"),".qs-item",t)})),e(".qs-repeater").each((function(){var t=e(this),a=t.find(".qs-container").eq(0),n=t.find(".qs-template").eq(0);if(0!==n.length){n=e(n.html());var s=function(){t.find(".qs-item").each((function(t){e(this).find("input, select, textarea").each((function(){var a=e(this).attr("name");a&&(a=a.replace(/\[-?\d+\]/,"["+t+"]"),e(this).attr("name",a))}))}))};t.on("click",".qs-add",(function(){var t=n.clone(),i=Math.round(1e8*Math.random()).toString(36);t.find("div, input, select, textarea, label").each((function(){var t="label"===this.nodeName.toLowerCase()?"for":"id",a=e(this).attr(t);a&&(a=a.replace("%",i),e(this).attr(t,a))})),a.append(t),s(),t.trigger("qs:item-added")})).on("click",".qs-delete",s),a.hasClass("qs-sortable")&&a.sortable("option","update",s)}})),"undefined"!=typeof google&&google.maps&&(e(".qs-map").each((function(){var t=e(this),a=t.data("type")||"ROADMAP";a=a.toUpperCase();var n=t.data("lat")||0,s=t.data("lng")||0,i=t.data("zoom")||5,o=t.find(".qs-value-lat"),l=t.find(".qs-value-lng"),r=t.find(".qs-value-zoom"),c=t.find(".qs-map-canvas"),d=t.find(".qs-map-search"),p=o.val(),g=l.val(),f=r.val(),m=!1;""!==p&&""!==g?(m=!0,f||(f=i)):(p=n,g=s,f=i),p=parseFloat(p),g=parseFloat(g),f=parseInt(f);var h=new google.maps.Map(c[0],{mapTypeId:google.maps.MapTypeId[a],center:new google.maps.LatLng(p,g),zoom:f}),u=new google.maps.Marker({position:new google.maps.LatLng(p,g),clickable:!1});m&&u.setMap(h),google.maps.event.addListener(h,"click",(function(e){var t=e.latLng.lat(),a=e.latLng.lng(),n=h.getZoom();o.val(t),l.val(a),r.val(n),u.setPosition(new google.maps.LatLng(t,a)),u.setMap(h),c.trigger("qs:marker-placed",[u])})),google.maps.event.addListener(h,"zoom_changed",(function(){r.val(h.getZoom())})),t.find(".qs-clear").click((function(){u.setMap(null)})),d.length>0&&d.find(".qs-submit").click((function(){var t=d.find(".qs-query").val();e.ajax({url:ajaxurl,data:{action:"qs_helper_geocode",address:t},type:"GET",dataType:"json",success:function(e){if(!e)return alert('Search for "'+t+'" turned up no results');var a=e.lat,n=e.lng,s=new google.maps.LatLng(a,n);o.val(a),l.val(n),r.val(14),u.setPosition(s),u.setMap(h),h.setCenter(s),h.setZoom(10),c.trigger("qs:marker-placed",[u])},error:function(){alert('Error attempting to geocode "'+t+'"')}})}))})),e("form#post").keypress((function(t){13===t.which&&e(t.target).is("input.qs-map-search")&&(t.preventDefault(),e(t.target).parents(".qs-map-field").find(".qs-search").click())})))}));